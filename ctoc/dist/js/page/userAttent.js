!function(){var a=$m.isOnline?"http://www.ymatou.com":"http://www.alpha.ymatou.com",b=a+"/login?ret="+escape(window.location.href),c=a+"/Message/Message/ListMessage?contactUserId=";$.getpageids=function(a,b){for(var c=a.split(","),d=Math.floor((c.length+b-1)/b),e=0;d>e;e++){for(var f="",g=0;b>g;g++){var h=e*b+g;if(h>c.length-1)break;f+=c[h]+","}f.length>0&&(f=f.substr(0,f.length-1)),$.idsarray.push(f)}},$.idsarray=[],$.tototalqty=function(a){return a>9999?"9999+":a},$.getdatetime=function(a){var b=a.split(" "),c=b[0].split("-"),d=b[1].split(":");return new Date(c[0],c[1],c[2],d[0],d[1],d[2])},$.gettimearray=function(a,b){var c=new Date(parseInt(a.replace(/\D/gim,""))),d=new Date(parseInt(b.replace(/\D/gim,""))),e=c.getHours(),f=c.getMinutes(),g=d.getHours(),h=d.getMinutes(),i=e-g,j=f-h,k=[0,0,0,0];return k[0]=Math.floor(i/10),k[1]=Math.floor(i%10),k[2]=Math.floor(j/10),k[3]=Math.floor(j%10),k},$.getnostarttime=function(a,b){var c=new Date(parseInt(a.replace(/\D/gim,""))),d=new Date(parseInt(b.replace(/\D/gim,"")));if(c.getTime()<b.getTime())return"";var e=c.getFullYear(),f=c.getMonth(),g=c.getDay(),h=c.getHours(),i=c.getMinutes(),j=d.getFullYear(),k=(d.getMonth(),d.getDay()),l=d.getHours(),m=d.getMinutes(),n=parseInt(i-m),o=parseInt(h-l),p=parseInt(g-k);return 1>o?n+"分钟后":1>p?o+"小时后":3>p?p+"天后,"+f+"月"+g+"日":e===j?f+"月"+g+"日":e+"年"+f+"月"+g+"日"},$.setlivinghtml=function(a,b){$("div.living-seller")[0]||$("div.seller-content").append('<div class="sc-living living-seller"><h3 class="main-title">正在直播的买手(<span id="restcount">'+$("#livingCount").val()+"</span>)</h3></div>");var d='<div class="sc-hd"><a class="seller-address" href="/shangou/activity/detail?activityid='+a.ActivityId+'" target="_blank"><i class="seller-icon si-site-w"></i><div class="address"><p>'+a.ActivityName+'</p><p class="number">'+a.ShopAddress+"</p></div></a></div>",e='<div class="user-info"><div class="user-hd"><a href="/seller/seller/index?id='+a.SellerId+'" target="_blank"><img src="'+a.Logo+'" class="avator"><div class="content"><p class="name">'+a.Seller+'</p><p class="country"><span class="country-flag"><img src="'+a.Flag+'"></span><span class="country-name">'+a.Country+'</span></p></div></a></div><div class="user-bd"><div class="nav-inline"><a href="javascript:void(0)">直播<span class="num">'+$.tototalqty(a.ActivityCount)+'</span></a><a href="javascript:void(0)">粉丝<span class="num">'+$.tototalqty(a.FollowUserNum)+'</span></a><a href="javascript:void(0)">商品<span class="num">'+$.tototalqty(a.TotalProductCount)+'</span></a></div></div><div class="user-ft"><a class="c-btn btn-gray" href="javascript:void(0)" data-area="0" data-sellerid="'+a.SellerId+'"><i lass="seller-icon si-atten"></i>已关注</a><a class="c-btn btn-light" href="'+c+a.SellerId+'" target="_blank">联系买手</a></div></div>',f=$.gettimearray(a.EndTime,b),g='<div class="living-content"><p class="countDown end"><span class="timeItem">'+f[0]+'</span><span class="timeItem">'+f[1]+'</span><i class="fl">:</i><span class="timeItem">'+f[2]+'</span><span class="timeItem">'+f[3]+'</span></p><div class="desc"><a ref="/shangou/activity/detail?activityid='+a.ActivityId+'" target="_blank">'+a.ActivityContent+'</a></div><div class="product-list">';if(a.ProductPics.length>0)for(var h=0;h<a.ProductPics.length;h++){var i=a.ProductPics[h].split("@@");g+='<a class="product" href="/shangou/product/detail?productid='+a.ProductIds[h]+'" target="_blank"><img src="'+i[0]+'"><span class="cover"><em>¥</em>'+i[1]+"</span></a>"}g+="</div></div>";var j='<div class="sc-bd">'+e+g+"</div>",k='<div class="sc-item" data-sellerid="'+a.SellerId+'">'+d+j+"</div>";$("div.living-seller").append(k),$("div.living-seller a[data-sellerid]").unbind("click").bind({click:$.cancelatten})},$.setwillhtml=function(a,b){$("div.will-seller")[0]||$("div.seller-content").append('<div class="will-seller"><h3 class="main-title">将要直播的买手(<span id="restcount">'+$("#willCount").val()+"</span>)</h3></div>");var d='<div class="user-info"><div class="user-hd"><a href="/seller/seller/index?id='+a.SellerId+'" target="_blank"><img src="'+a.Logo+'" class="avator"><div class="content"><p class="name">'+a.Seller+'</p><p class="country"><span class="country-flag"><img src="'+a.Flag+'"></span><span class="country-name">'+a.Country+'</span></p></div></a></div><div class="user-bd"><div class="nav-inline"><a href="javascript:void(0)">直播<span class="num">'+$.tototalqty(a.ActivityCount)+'</span></a><a href="javascript:void(0)">粉丝<span class="num">'+$.tototalqty(a.FollowUserNum)+'</span></a><a href="javascript:void(0)">商品<span class="num">'+$.tototalqty(a.TotalProductCount)+'</span></a></div></div><div class="user-ft"><a class="c-btn btn-gray" href="javascript:void(0)" data-area="1" data-sellerid="'+a.SellerId+'"><i lass="seller-icon si-atten"></i>已关注</a><a class="c-btn btn-light" href="'+c+a.SellerId+'" target="_blank">联系买手</a></div></div>',e='<div class="living-content"><p class="start-time">'+$.getnostarttime(a.BeginTime,b)+'</p><a class="seller-address" href="/shangou/activity/detail?activityid='+a.ActivityId+'" target="_blank"><i class="seller-icon si-site"></i><div class="address"><p>'+a.ActivityName+'</p><p class="number">'+a.ShopAddress+'</p></div></a><div class="desc"><a href="/shangou/activity/detail?activityid='+a.ActivityId+'" target="_blank">'+a.ActivityContent+"</a></div></div>",f='<div class="sc-bd">'+d+e+"</div>",g='<div class="sc-item" data-sellerid="'+a.SellerId+'">'+f+"</div>";$("div.will-seller").append(g),$("div.will-seller a[data-sellerid]").unbind("click").bind({click:$.cancelatten})},$.setresthtml=function(a){$("div.rest-seller")[0]||$("div.seller-content").append('<div class="rest-seller"><h3 class="main-title">休息中的买手(<span id="restcount">'+$("#restCount").val()+'</span>)</h3><div class="rest-seller-list"></div></div>');var b='<div class="sc-item" data-sellerid="'+a.SellerId+'"><div class="sc-bd"><div class="user-info"><div class="user-hd"><a href="/seller/seller/index?id='+a.SellerId+'" target="_blank"><img src="'+a.Logo+'" class="avator"><div class="content"><p class="name">'+a.Seller+'</p><p class="country"><span class="country-flag"><img src="'+a.Flag+'"></span><span class="country-name">'+a.Country+'</span></p></div></a></div><div class="user-bd"><div class="nav-inline"><a href="javascript:void(0)">直播<span class="num">'+$.tototalqty(a.ActivityCount)+'</span></a><a href="javascript:void(0)">粉丝<span class="num">'+$.tototalqty(a.FollowUserNum)+'</span></a><a href="javascript:void(0)">商品<span class="num">'+$.tototalqty(a.TotalProductCount)+'</span></a></div></div><div class="user-ft"><a class="c-btn btn-gray" href="javascript:void(0)" data-area="2" data-sellerid="'+a.SellerId+'"><i class="seller-icon si-atten"></i>已关注</a><a class="c-btn btn-light" href="'+c+a.sellerId+'" target="_blank">联系买手</a></div></div></div></div>';$("div.rest-seller-list").append(b),$("div.rest-seller-list a[data-sellerid]").unbind("click").bind({click:$.cancelatten})},$.setempty=function(){var a='<div class="seller_nodata"><div class="seller_icons"><i class="icon icon-followseller"></i>还没有关注任何买手呢~</div><div class="seller_txt"><p>扫一扫</p><p>下载扫货神器APP</p><p>可以搜索买手哦~</p><img src="http://static.ymatou.com//content/home/images/globalqr.jpg" width="200" height="200" /></div></div>';$(".seller-content").html(a)},$.cancelatten=function(){var a=$(this).data("sellerid"),c=$(this).data("area");return $.ajax({type:"post",url:"/user/Attention/CancelAttentionSeller",data:{sellerid:a},success:function(d){if(401===d.Status)return void window.location.href.replace(b);if(200===d.Status){$("div.sc-item[data-sellerid="+a+"]").remove();var e="",f="";switch(c){case 0:e="living-seller",f="livingcount";break;case 1:e="will-seller",f="willcount";break;case 2:e="rest-seller",f="restcount";break;default:return}var g=parseInt($("#"+f).text())-1;$("#"+f).text(g);var h=parseInt($("#livingcount").text()||0)+parseInt($("#willcount").text()||0)+parseInt($("#restcount").text()||0);1>g&&$("div."+e).remove(),1>h&&$.setempty();var i=$(".user-bd li.current").html();i=i.replace(/\(\s*\d*\s*\)/gi,"("+h+")"),$(".user-bd li.current").html(i)}else alert(d.Msg)},error:function(){}}),!1},$(function(){if($("#sellerids")[0]){var a=$("#sellerids").val();0!==a.length&&($.getpageids(a,10),$(window).scroll(function(){if(0!==$.idsarray.length){var a="";$.each($.idsarray[0].split(","),function(b,c){a+="SellerIds="+c+"&"}),a.length>0&&(a=a.substr(0,a.length-1)),$.idsarray.splice(0,1),$.ajax({type:"post",url:"/user/Attention/GetAttentionSellerList",data:a,success:function(a){return 401===a.Status?void window.location.href.replace(b):void $.each(a.Result,function(b,c){0===c.ActivityState?$.setlivinghtml(c,a.ServerTime):-1===c.ActivityState?$.setwillhtml(c,a.ServerTime):$.setresthtml(c)})},error:function(){}})}}))}}),$("a[data-sellerid]").bind({click:$.cancelatten})}();