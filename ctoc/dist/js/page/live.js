function endTimes(a,b){var c=new Date(parseInt(a.replace(/\D/gim,""))),d=new Date(parseInt(b.replace(/\D/gim,"")));ts=c-d;var e=(parseInt(ts/1e3/60/60/24,10)>=0?parseInt(ts/1e3/60/60/24,10):0,parseInt(ts/1e3/60/60%24,10)>=0?parseInt(ts/1e3/60/60%24,10):0),f=parseInt(ts/1e3/60%60,10)>=0?parseInt(ts/1e3/60%60,10):0,g=parseInt(ts/1e3%60,10)>=0?parseInt(ts/1e3%60,10):0,h=0==e&&30>f;e=e.toString().length>1?e:"0"+e,f=f.toString().length>1?f:"0"+f,g=g.toString().length>1?g:"0"+g;for(var i=e.toString()+f.toString(),j=[],k=0;k<i.length;k++)j.push(i.substring(k,k+1));return{isTrue:h,date:j}}function hasNeedFillNode(a){return a.children(".cli").length<3}function templet(a,b,c){even=null==even?!a%2==0:even;var d="",e="",f="",g="",h="",i="",j="",k=$(".li_size:last .sql_content"),l=k.length&&hasNeedFillNode(k),m=0;for(var n in b){var o=endTimes(b[n].EndTime,c);j='<li><span class="clock '+(o.isTrue?"s1":"s2")+'">',j+='<span class="c1">'+o.date[0]+"</span>",j+='<span class="c2">'+o.date[1]+"</span>",j+='<span class="c3">'+o.date[2]+"</span>",j+='<span class="c4">'+o.date[3]+"</span></span></li>";for(s in b[n].ProductPics)s<3&&(b[n].ProductPics[s]=b[n].ProductPics[s].split("@"),h+='<li><a href="/shangou/product/detail?productid='+b[n].ProductIds[s]+'" target="_blank"><img src="'+b[n].ProductPics[s][0]+'"/><strong class="txt">￥'+b[n].ProductPics[s][1]+'</strong><span class="bg"></span></a></li>');i='<li class="cli">',i+="<a class='productLinkBox' href=\"/shangou/activity/detail?activityid="+b[n].ActivityId+'" target="_blank"><span class="cli_local">',i+='<i class="icon icon-location"></i>',i+="<h5>"+b[n].ActivityName+"</h5>",i+="<p>"+b[n].ShopAddress+"</p>",i+="<img src="+b[n].ActivityPicture+' width="100%" />',i+="</span></a>",i+='<span class="cli_seller">',i+='<span class="seller_info">',i+='<span class="seller_avatar"><a href="/seller/seller/index?id='+b[n].SellerId+'" target="_blank"><img src="'+b[n].SellerLogo+'" /></a></span>',i+='<span class="seller_name">',i+='<h5><a href="/seller/seller/index?id='+b[n].SellerId+'" target="_blank">'+b[n].Seller+"</a></h5>",i+='<p><span class="country_logo"><img src="'+b[n].Flag+'" /></span>'+b[n].Country+"</p>",i+="</span>",i+="</span>",i+='<span class="follow_seller">',i+='<span class="btn '+(b[n].BeConcerned?"btn-unfollow":"btn-follow")+'" onclick="clickFollow(this,'+b[n].ActivityId+","+b[n].BeConcerned+')">',i+='<i class="icon '+(b[n].BeConcerned?"icon-check01":"icon-add")+'"></i><strong class="txt">'+(b[n].BeConcerned?"已关注":"关注")+"</strong>",i+="</span>",i+="</span>",i+="</span>",i+='<a class="cli_des" href="/shangou/activity/detail?activityid='+b[n].ActivityId+'">'+b[n].ActivityInfo+' </a><span class="cli_product">',i+="<ol class='clearfix'>"+h+"</ol>",i+="</span>",i+="</li>",l?(k.append(i),i="",h="",k=$(".li_size:last .sql_content"),l=hasNeedFillNode(k),m++):((n-m+1)%3==0?(g+=j,e+=i,d='<div class="sql_time '+(0==a?"linetop":even?"line_s1":"line_s2")+'"><ol class="time_list">'+g+"</ol></div>",f+='<div class="sql_i_list li_size">'+d+'<ul class="sql_content clearfix '+(even?"line_left":"line_right")+'">'+e+"</ul></div>",e="",d="",g="",a++,even=!even):(g+=j,e+=i),h="")}(b.length<3&&0!=b.length||b.length%3!=0)&&(d='<div class="sql_time '+(0==a?"linetop":even?"line_s1":"line_s2")+'"><ol class="time_list">'+g+"</ol></div>",f+='<div class="sql_i_list li_size">'+d+'<ul class="sql_content clearfix '+(even?"line_left":"line_right")+'">'+e+"</ul></div>",even=!even);var p="";return 0!=_PostArr.length&&(p='<div class="sql_i_list" id="endList"><div class="sql_time '+(even?"linebottom_r":"linebottom_l")+'"><div class="sq_loaddate"></div></div></div>'),f+p}function liveLoad(a){var b=$(".sql_list .li_size").size(),c=[],d=[],e=0,f="";if(LiveArr="undefined"!=typeof a?a:LiveArr,LiveArr.length<0)return!1;if(LiveArr&&0==LiveArr.length)return $(".sq_live_list").hide(),$(".sq_nodata").show(),!1;if($(".sq_live_list").show(),$(".sq_nodata").hide(),0==_PostArr.length){for(var g in LiveArr)e==number-1?(c.push(LiveArr[g]),d.push(c),c=[],e=0):(c.push(LiveArr[g]),e++);c.length<number&&d.push(c),_PostArr=d}if(_PostArr[isId]&&_PostArr[isId].length>0){for(var h in _PostArr[isId])f+="activityids="+_PostArr[isId][h]+"&";f=f.substring(0,f.lastIndexOf("&")),isStart&&(isStart=!1,$.ajax({type:"post",url:"/shangou/activity/GetActivityListByIds",data:f,success:function(a){$(".sql_list").append(templet(b,a.Result.Activities,a.ServerTime)),isId++,isStart=!0}}))}else $(".sql_time .sq_loaddate").remove(),$(".sql_time:last").html('<span class="end_txt">当前的直播被你刷完啦~ 过一会再来看看吧</span>')}function parseCategoryAndReturnHtml(a){function b(){for(var b,e,k,l,m,n=0,o=a.length;o>n;n++)if(k=a[n].Catalog,null!=k&&void 0!=k){if(e=k.indexOf("@"),b=a[n].Catalog.slice(e+1).split(","),0==b.length)return;for(var p=0;p<b.length;p++)l=b[p].split(":"),m=l[1],l="k"+f(l[0]),h[l]=h[l]||[],h[l].push(m)}else(null==k||void 0==k)&&$("#hidCatalogId").val(a[n].CatalogId);for(var q in h)j+=1,h[q]=g(h[q]),c(h[q],q);return d(i)}function c(b,c){for(var d,g=0,h=a.length;h>g;g++)for(var j=0;j<b.length;j++)a[g].Catalog.indexOf(e(c)+":"+b[j])>-1&&(d=f(b[j]),i[c]=i[c]||{},i[c]["v"+d]=i[c]["v"+d]||[],i[c]["v"+d].push(a[g].CatalogId))}function d(a){var b,c=[];c.push('<div class="size">');for(var d in a){b=e(d),c.push("<p>商品"+b+":");for(var f in a[d])c.push(e(f)+"，");c[c.length-1]&&(c[c.length-1]=c[c.length-1].slice(0,-1)),c.push("</p>")}return c.push("</div>"),c.join("")}function e(a){a=a.slice(1).split("-");for(var b=0;b<a.length;b++)a[b]=String.fromCharCode(a[b]);return a.join("")}function f(a){for(var b=[],c=0,d=a.length;d>c;c++)b.push(a.charCodeAt(c));return b.join("-")}function g(a){for(var b=[],c=0;c<a.length;c++)-1==$m.indexOf(a[c],b)&&b.push(a[c]);return b}var a,h={},i={},j=0;return b()}function loadActivity(a){if(void 0!==pid&&aend&&!isLoading&&hasData){aend=!1;var b="/shangou/activity/GetActivityProductList?ActivityId="+a+"&LastProductId="+pid;isLoading=!0,$.ajax({type:"GET",url:b,success:function(a){200==a.Status?a.Result.length>0?(aend=!0,$(".live_product .plist").append(activityHtml(a.Result)),pid=a.Result[a.Result.length-1].ProductId):hasData=!1:alert(a.Msg)},complete:function(){console.log("complete"),isLoading=!1}})}}function clickFollow(a,b,c){var a=$(a),d="";return-1!=a.attr("class").indexOf("btn-follow")?(d="/user/Attention/AttentionSeller",a.find(".icon").removeClass("icon-add").addClass("icon-check01"),a.addClass("btn-unfollow").find(".txt").text("已关注")):(d="/user/Attention/CancelAttentionSeller",a.find(".icon").removeClass("icon-check01").addClass("icon-add"),a.removeClass("btn-unfollow").find(".txt").text("关注")),$.ajax({type:"post",url:d,data:{SellerId:b,BeConcerned:c},success:function(b){if(200!=b.Status)window.location.href=retUrl;else{var c=parseInt($("#FocusCount").html());a.hasClass("btn-unfollow")?++c:c=c>0?c-1:0,$("#FocusCount").html(c),-1!=a.attr("class").indexOf("btn-follow")?a.removeClass("btn-follow").addClass("btn-unfollow").find(".txt").text("已关注").end().find(".icon").removeClass("icon-add").addClass("icon-check01"):a.find(".icon").removeClass("icon-check01").addClass("icon-add").end().removeClass("btn-unfollow").addClass("btn-follow").find(".txt").text("关注")}}}),!1}function OrderShowComment(a){var b=$(a),c=b.parent(),d=b.attr("data-param-id"),e=c.find("[name=content]"),f=e.val().replace(/^\s+|\s+$/g,""),g=c.find("[name=isHideName]").attr("checked")?1:0;if(!f||""==f||/^\s/.test(f))return alert("评论内容不允许为空！"),!1;if(f.length>60)return alert("评论内容最多只能60个字符！"),!1;var h=$("#hidUserName").val();return h||g?void $.ajax({type:"post",url:"/shangou/product/AddComment",data:"ProductId="+d+"&content="+f+"&anonymity="+g,success:function(a){if(200==a.Status){if(e.val(""),$("#p_comment").size()>0){var b=parseInt($("#p_comment .CommentCount").html())+1;$("#p_comment .CommentCount").html(b),h=g?"爱海购的TA":h,$("#p_comment .comments").prepend('<li><p><span class="name">'+h+'</span><span class="time"><em></em>刚刚</span></p><h3 class="article">'+f+"</h3></li>")}alert("评论成功")}else 401==a.Status?window.location.href=retUrl:alert(a.Msg)},error:function(){alert("添加评论失败，请稍后再试")}}):void(window.location.href=retUrl)}var number=9,_PostArr=[],LiveArr=$("#activityids").val()?$("#activityids").val().split(","):[],isId=0,retUrl=($m.isOnline?"http://www.ymatou.com/login?ret=":"http://www.alpha.ymatou.com/login?ret=")+window.location.href,timer=null,isStart=!0,isAstat=!0,even=null,pid=$(".plist .pli:last").find(".pli_prodictid").val(),aend=!0,cTrue=!0,cEnd=!0,isLoading=!1,hasData=!0,beforeTime=function(a){var b,c,d,e,f=parseInt((new Date).getTime()/1e3),g=parseInt(new Date(a).getTime()/1e3);return e=f-g,d=parseInt(e/86400),c=parseInt(e/3600),b=parseInt(e/60),d>0&&365>d?d+"天前":0>=d&&c>0?c+"小时前":0>=c&&b>0?b+"分钟前":"刚刚"};$(".slt_list li").click(function(){var a=$(this).attr("data-desc")&&""!=$(this).attr("data-desc")?$(this).attr("data-desc"):"",b=$(this).attr("data-count")&&""!=$(this).attr("data-count")?$(this).attr("data-count"):!1,c=$(this).attr("data-groupid")&&""!=$(this).attr("data-groupid")?$(this).attr("data-groupid"):!1;b&&c&&(_PostArr=[],isId=0,even=null,$(".count").text(b),$(".country").text(a),$(".sql_list").html(""),$(".slt_list li").removeClass("active"),$(this).addClass("active"),$.ajax({type:"GET",url:"/shangou/activity/GetActivityIds?groupid="+c,success:function(a){var b=[];for(var c in a.Activities)b.push(a.Activities[c].ActivityId);liveLoad(b)}}))});var activityHtml=function(a){var b,c,d="";for(b in a){var e="",f=a[b].ProductPics;a[b].TariffType&&a[b].FreeShipping?e='<span class="labels_b labels_b_red">包邮包税</span>':0==a[b].TariffType?e='<span class="labels_b labels_b_red">包税</span>':a[b].FreeShipping&&(e='<span class="labels_b labels_b_red">包邮</span>');if(d+='<div class="pli">',d+='<input type="hidden" name="prodictid" class="pli_prodictid" value="'+a[b].ProductId+'">',d+='<div class="pic j_show_share" data-href="/shangou/product/detail?productid='+a[b].ProductId+'">',d+='<div class="share-wrap j_share share-light">',d+='<div class="share-type" style="display: none;">',d+='<span class="weibo"><a class="share-icon i-weibo" href="http://service.weibo.com/share/share.php?title='+a[b].ProductDesc+"&amp;url="+encodeURIComponent("http://"+location.host+"/shangou/product/detail?productid="+a[b].ProductId)+"&amp;source=bookmark&amp;appkey=2992571369&amp;pic="+a[b].ProductPics[0]+'&amp;ralateUid=" target="_blank"></a></span>',d+='<span class="weixin" data-product-id="'+a[b].ProductId+'"><strong class="share-icon i-weixin"></strong></span>',d+="</div>",d+='<span class="share-btn j_praise">分享</span>',d+="</div>",f.length>=4){for(d+='<ul class="pic_list">',c=0;4>c;c++)d+='<li class="item'+c+'"><a href="/shangou/product/detail?productid='+a[b].ProductId+'" target="_blank"><img width="150" src="'+f[c]+'"></a></li>';d+="</ul>"}else d+='<a href="/shangou/product/detail?productid='+a[b].ProductId+'" target="_blank"><img width="100%" src="'+f[0]+'"></a>';d+="</div>",d+='<div class="info">',d+='<div class="mian">',d+='<div class="title">',d+='<a href="/shangou/product/detail?productid='+a[b].ProductId+'" target="_blank">',d+=e+" "+a[b].ProductDesc+"</a>",d+="</div>",d+=parseCategoryAndReturnHtml(a[b].Catalogs),d+="</div>",d+='<div class="outher">',d+='<div class="price">',d+="<span>预估到手价</span>",d+="<strong>￥"+a[b].Price+"</strong>",d+="</div>",d+='<div class="buybtn">',d+=a[b].StockNum>0?'<a class="btn btn-buy" href="/order/order/buy?pid='+a[b].ProductId+'">立刻购买</a>':'<a class="btn btn-unbuy" href="javascrpt:void(0)">已售罄</a>',d+="</div>",d+="</div>",d+="</div>",d+='<div class="comment">',d+='<div class="ct"><i class="icon icon-comment"></i>评论'+a[b].CommentCount+"</div>",d+='<div class="cli">',a[b].Comments.length>0&&(d+="<ol>",$(a[b].Comments).each(function(a,b){d+="<li><h6>"+b.UserName+"：</h6><p>"+b.Content+"</p></li>"}),d+="</ol>"),d+=" </div>",d+='<div class="csend">',d+='<textarea name="content"></textarea>',d+='<span class="fl">',d+='<label class="label"><input type="checkbox" id="a_commentCheckbox" name="isHideName">匿名</label>',d+="</span>",d+='<span class="btn btn-mini j-commentsSend fr" data-param-id="'+a[b].ProductId+'">发送</span>',d+="</div>",d+="</div>",d+="</div>"}return d},OutTime=0;$(window).scroll(function(){OutTime&&clearTimeout(OutTime),OutTime=setTimeout(function(){var a=$(this).scrollTop(),b=$(document).height(),c=$(this).height();if($(".sq_live_list").length>0){var d=$(".sq_live_list"),e=d.offset(),f=parseInt(d.css("height"));f+e.top<=a+c&&(LiveArr.length>0?liveLoad():($(".sql_time .sq_loaddate").remove(),$(".sql_time:last").html('<span class="end_txt">当前的直播被你刷完啦，过一会再来看看吧。</span>')))}if($(".live_product .plist").length>0){var g=$(".live_product .plist"),h=(g.offset(),parseInt(g.css("height")),$("#activityid").val());b-$(".footer").height()-a-c<=303&&loadActivity(h)}},100)}),function(a){function b(){c[f()?"fadeOut":"fadeIn"]()}var c,d=$(".fixedReplay"),e=$(a);if(d[0]){$("body").append('<div class="replay_fixed_box clearfix"></div>'),c=d.clone(),c.appendTo($(".replay_fixed_box")).addClass("fixed-replay-warp").hide();var f=function(){return d.offset().top>=e.scrollTop()&&d.offset().top<=e.scrollTop()+e.height()};b(),$(a).scroll(b)}}(window),$(".j_follow").live("click",function(){var a=$(this),b="false"==a.attr("data-is-follow");clickFollow(this,a.attr("data-follow-id"),b)});var compileTpls=function(a,b){var c,d="{{\\s*",e="\\s*}}";for(var f in b)c=new RegExp(d+f+e,"g"),a=a.replace(c,b[f]);return a=a.replace(/{{}}/g,"")},showComment=function(a){for(f in a)/\/Date\(\d*\)\//.test(a[f].AddTime)&&(b=a[f].AddTime.replace(/[^0-9]/g,""),c=new Date(parseInt(b,10)),a[f].AddTime=beforeTime(new Date(parseInt(b)).getTime()));for(var b,c,d=['<li><input type="hidden" name="commentid" value="{{CommentId}}">','<p><span class="name">{{showName}}</span><span class="time"><em></em>{{AddTime}}</span></p>','<h3 class="article">{{Content}}</h3>',"</li>"],e="",f=0,g=a.length;g>f;f++)a[f].showName=a[f].UserName,1==a[f].HideUser&&(a[f].showName="匿名"),/\/Date\(\d*\)\//.test(a[f].AddTime)&&(b=a[f].AddTime.replace(/[^0-9]/g,""),c=new Date(parseInt(b,10)),a[f].AddTime=c.getFullYear()+"年"+(c.getMonth()+1)+"月"+c.getDate()+"日"),e+=compileTpls(d.join(""),a[f]);return e};$m.load("module/widget/waterfall",function(a){a({selector:".comments",url:"/shangou/Product/GetProductCommentList?",options:{ProductId:$("#productid").val(),LastCommentId:0,CommentNum:"10"},increment:"LastCommentId",callback:function(a){var b=a.Result||[];return $(".comments").append(showComment(b)),b.length<0&&(cTrue=!1),b.length&&b[b.length-1].CommentId}})}),$m.load("module/widget/slide",function(a){a("#FocusImages",{panels:".images .item",triggers:".focus .item",effect:"fade",hasDirection:!0,directionTriggers:[".prevarrow",".nextarrow"],interval:3,triggerType:"mouse"})}),$(".j-commentsSend").live("click",function(a){a.preventDefault();$(this);OrderShowComment(this)}),Ymt.add(function(a){var b=a("module/util/cookie"),c=b.get("isOlder"),d="/"===location.pathname,e=($(window).height()-568)/2;if(!c&&d){var f=[];f.push('<div id="mask" style="display:block">'),f.push('<div class="mask-inner">'),f.push('<div class="step1" style="margin-top:'+e+'px">'),f.push('<p><span  class="new-tips nt-step1"></span></p>'),f.push('<p class="new-tips nt-next" id="J-step1"></p>'),f.push("</div>"),f.push('<div class="step2" style="display:none;margin-top:'+e+'px">'),f.push('<p><span  class="new-tips nt-step2"></span></p>'),f.push('<p class="new-tips nt-next" id="J-step2"></p>'),f.push("</div>"),f.push('<div class="step3" style="display:none">'),f.push('<span  class="new-tips nt-step3-1"></span>'),f.push('<span  class="new-tips nt-step3-2"></span>'),f.push('<span  class="new-tips nt-step3-3"></span>'),f.push('<span  class="new-tips nt-step3-4"></span>'),f.push('<p id="J-close"><span class="new-tips nt-close"></span></p>'),f.push("</div>"),f.push("</div>"),f.push("</div>"),scrollTo(0,0),$("body").append(f.join("")),$("body").css("overflow","hidden"),$("#J-step1").click(function(){$(".step1").hide(),$(".step2").show()}),$("#J-step2").click(function(){$(".step2").hide(),$(".step3").show()}),$("#J-close").click(function(){$("body").css("overflow","auto"),$("#mask").remove()}),b.set("isOlder",!0)}}),+function(){function a(a){a.addClass("active").siblings().removeClass("active")}if($("#p_comment").size()>0){{var b=$(".fix_tab"),c=$(".p_main").offset().top,d=$("#p_comment").offset().top-b.height();b.find("ul.fl li").eq(0),b.find("ul.fl li").eq(1)}$("ul.fl li").bind("click",function(){c=$(".p_main").offset().top,d=$("#p_comment").offset().top-b.height(),a($(this))}),$(window).scroll(function(){var a=$(this).scrollTop();b.length>0&&b.css(a>c?{position:"fixed",top:"0"}:{position:"relative",top:"0"})})}}();