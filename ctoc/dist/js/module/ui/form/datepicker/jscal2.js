Calendar=function(){function a(b){b=b||{},this.args=b=H(b,{animation:!cb,cont:null,bottomBar:!0,date:!0,fdow:y("fdow"),min:null,max:null,reverseWheel:!1,selection:[],selectionType:a.SEL_SINGLE,weekNumbers:!1,align:"Bl/ / /T/r",inputField:null,trigger:null,dateFormat:"%Y-%m-%d",opacity:bb?1:3,titleFormat:"%b %Y",showTime:!1,timePos:"right",time:!0,minuteStep:5,disabled:mb,checkRange:!1,dateInfo:mb,onChange:mb,onSelect:mb,onTimeChange:mb,onFocus:mb,onBlur:mb}),this.handlers={};var c=this,d=new Date;b.min=F(b.min),b.max=F(b.max),b.date===!0&&(b.date=d),b.time===!0&&(b.time=100*d.getHours()+Math.floor(d.getMinutes()/b.minuteStep)*b.minuteStep),this.date=F(b.date),this.time=b.time,this.fdow=b.fdow,Y("onChange onSelect onTimeChange onFocus onBlur".split(/\s+/),function(a){var d=b[a];d instanceof Array||(d=[d]),c.handlers[a]=d}),this.selection=new a.Selection(b.selection,b.selectionType,v,this);var e=i.call(this);b.cont&&Z(b.cont).appendChild(e),b.trigger&&this.manageFields(b.trigger,b.inputField,b.dateFormat)}function b(a){var b=["<table",gb,"><tr>"],c=0;for(a.args.weekNumbers&&b.push("<td><div class='DynarchCalendar-weekNumber'>",y("wk"),"</div></td>");7>c;){var d=(c++ +a.fdow)%7;b.push("<td><div",y("weekend").indexOf(d)>=0?" class='DynarchCalendar-weekend'>":">",y("sdn")[d],"</div></td>")}return b.push("</tr></table>"),b.join("")}function c(a,b,c){b=b||a.date,c=c||a.fdow,b=new Date(b.getFullYear(),b.getMonth(),b.getDate(),12,0,0,0);var d=b.getMonth(),e=[],f=0,g=a.args.weekNumbers;b.setDate(1);var h=(b.getDay()-c)%7;0>h&&(h+=7),b.setDate(-h),b.setDate(b.getDate()+1);var i=new Date,j=i.getDate(),k=i.getMonth(),l=i.getFullYear();e[f++]="<table class='DynarchCalendar-bodyTable'"+gb+">";for(var m=0;6>m;++m){e[f++]="<tr class='DynarchCalendar-week",0==m&&(e[f++]=" DynarchCalendar-first-row"),5==m&&(e[f++]=" DynarchCalendar-last-row"),e[f++]="'>",g&&(e[f++]="<td class='DynarchCalendar-first-col'><div class='DynarchCalendar-weekNumber'>"+z(b)+"</div></td>");for(var n=0;7>n;++n){var o=b.getDate(),p=b.getMonth(),q=b.getFullYear(),r=1e4*q+100*(p+1)+o,s=a.selection.isSelected(r),t=a.isDisabled(b);e[f++]="<td class='",0!=n||g||(e[f++]=" DynarchCalendar-first-col"),0==n&&0==m&&(a._firstDateVisible=r),6==n&&(e[f++]=" DynarchCalendar-last-col",5==m&&(a._lastDateVisible=r)),s&&(e[f++]=" DynarchCalendar-td-selected"),e[f++]="'><div dyc-type='date' unselectable='on' dyc-date='"+r+"' ",t&&(e[f++]="disabled='1' "),e[f++]="class='DynarchCalendar-day",y("weekend").indexOf(b.getDay())>=0&&(e[f++]=" DynarchCalendar-weekend"),p!=d&&(e[f++]=" DynarchCalendar-day-othermonth"),o==j&&p==k&&q==l&&(e[f++]=" DynarchCalendar-day-today"),t&&(e[f++]=" DynarchCalendar-day-disabled"),s&&(e[f++]=" DynarchCalendar-day-selected"),t=a.args.dateInfo(b),t&&t.klass&&(e[f++]=" "+t.klass),e[f++]="'>"+o+"</div></td>",b=new Date(q,p,o+1,12,0,0,0)}e[f++]="</tr>"}return e[f++]="</table>",e.join("")}function d(a){var c=["<table class='DynarchCalendar-topCont'",gb,"><tr><td><div class='DynarchCalendar'>",bb?"<a class='DynarchCalendar-focusLink' href='#'></a>":"<button class='DynarchCalendar-focusLink'></button>","<div class='DynarchCalendar-topBar'><div dyc-type='nav' dyc-btn='-Y' dyc-cls='hover-navBtn,pressed-navBtn' class='DynarchCalendar-navBtn DynarchCalendar-prevYear'><div></div></div><div dyc-type='nav' dyc-btn='+Y' dyc-cls='hover-navBtn,pressed-navBtn' class='DynarchCalendar-navBtn DynarchCalendar-nextYear'><div></div></div><div dyc-type='nav' dyc-btn='-M' dyc-cls='hover-navBtn,pressed-navBtn' class='DynarchCalendar-navBtn DynarchCalendar-prevMonth'><div></div></div><div dyc-type='nav' dyc-btn='+M' dyc-cls='hover-navBtn,pressed-navBtn' class='DynarchCalendar-navBtn DynarchCalendar-nextMonth'><div></div></div><table class='DynarchCalendar-titleCont'",gb,"><tr><td><div dyc-type='title' dyc-btn='menu' dyc-cls='hover-title,pressed-title' class='DynarchCalendar-title'>",e(a),"</div></td></tr></table><div class='DynarchCalendar-dayNames'>",b(a),"</div></div><div class='DynarchCalendar-body'></div>"];return(a.args.bottomBar||a.args.showTime)&&c.push("<div class='DynarchCalendar-bottomBar'>",h(a),"</div>"),c.push("<div class='DynarchCalendar-menu' style='display: none'>",f(a),"</div><div class='DynarchCalendar-tooltip'></div></div></td></tr></table>"),c.join("")}function e(a){return"<div unselectable='on'>"+E(a.date,a.args.titleFormat)+"</div>"}function f(a){for(var b,c=["<table height='100%'",gb,"><tr><td><table style='margin-top: 1.5em'",gb,"><tr><td colspan='3'><input dyc-btn='year' class='DynarchCalendar-menu-year' size='6' value='",a.date.getFullYear(),"' /></td></tr><tr><td><div dyc-type='menubtn' dyc-cls='hover-navBtn,pressed-navBtn' dyc-btn='today'>",y("goToday"),"</div></td></tr></table><p class='DynarchCalendar-menu-sep'>&nbsp;</p><table class='DynarchCalendar-menu-mtable'",gb,">"],d=y("smn"),e=0,f=c.length;12>e;){for(c[f++]="<tr>",b=4;--b>0;)c[f++]="<td><div dyc-type='menubtn' dyc-cls='hover-navBtn,pressed-navBtn' dyc-btn='m"+e+"' class='DynarchCalendar-menu-month'>"+d[e++]+"</div></td>";c[f++]="</tr>"}return c[f++]="</table></td></tr></table>",c.join("")}function g(a,b){b.push("<table class='DynarchCalendar-time'"+gb+"><tr><td rowspan='2'><div dyc-type='time-hour' dyc-cls='hover-time,pressed-time' class='DynarchCalendar-time-hour'></div></td><td dyc-type='time-hour+' dyc-cls='hover-time,pressed-time' class='DynarchCalendar-time-up'></td><td rowspan='2' class='DynarchCalendar-time-sep'></td><td rowspan='2'><div dyc-type='time-min' dyc-cls='hover-time,pressed-time' class='DynarchCalendar-time-minute'></div></td><td dyc-type='time-min+' dyc-cls='hover-time,pressed-time' class='DynarchCalendar-time-up'></td>"),12==a.args.showTime&&b.push("<td rowspan='2' class='DynarchCalendar-time-sep'></td><td rowspan='2'><div class='DynarchCalendar-time-am' dyc-type='time-am' dyc-cls='hover-time,pressed-time'></div></td>"),b.push("</tr><tr><td dyc-type='time-hour-' dyc-cls='hover-time,pressed-time' class='DynarchCalendar-time-down'></td><td dyc-type='time-min-' dyc-cls='hover-time,pressed-time' class='DynarchCalendar-time-down'></td></tr></table>")}function h(a){function b(){d.showTime&&(c.push("<td>"),g(a,c),c.push("</td>"))}var c=[],d=a.args;return c.push("<table",gb," style='width:100%'><tr>"),"left"==d.timePos&&b(),d.bottomBar&&(c.push("<td>"),c.push("<table",gb,"><tr><td><div dyc-btn='today' dyc-cls='hover-bottomBar-today,pressed-bottomBar-today' dyc-type='bottomBar-today' class='DynarchCalendar-bottomBar-today'>",y("today"),"</div></td></tr></table>"),c.push("</td>")),"right"==d.timePos&&b(),c.push("</tr></table>"),c.join("")}function i(){var a=O("div"),b=this.els={},c={mousedown:Q(p,this,!0),mouseup:Q(p,this,!1),mouseover:Q(t,this,!0),mouseout:Q(t,this,!1),keypress:Q(w,this)};return c[db?"DOMMouseScroll":"mousewheel"]=Q(u,this),bb&&(c.dblclick=c.mousedown,c.keydown=c.keypress),a.innerHTML=d(this),R(a.firstChild,function(a){var c=hb[a.className];c&&(b[c]=a),bb&&a.setAttribute("unselectable","on")}),I(b.main,c),I([b.focusLink,b.yearInput],this._focusEvents={focus:Q(j,this),blur:Q(l,this)}),this.moveTo(this.date,!1),this.setTime(null,!0),b.topCont}function j(){this._bluringTimeout&&clearTimeout(this._bluringTimeout),this.focused=!0,M(this.els.main,"DynarchCalendar-focused"),this.callHooks("onFocus",this)}function k(){this.focused=!1,L(this.els.main,"DynarchCalendar-focused"),this._menuVisible&&o(this,!1),this.args.cont||this.hide(),this.callHooks("onBlur",this)}function l(){this._bluringTimeout=setTimeout(Q(k,this),50)}function m(a){switch(a){case"time-hour+":this.setHours(this.getHours()+1);break;case"time-hour-":this.setHours(this.getHours()-1);break;case"time-min+":this.setMinutes(this.getMinutes()+this.args.minuteStep);break;case"time-min-":this.setMinutes(this.getMinutes()-this.args.minuteStep);break;default:return}}function n(a,b,c){this._bodyAnim&&this._bodyAnim.stop();var d;if(0!=b)switch(d=new Date(a.date),d.setDate(1),b){case"-Y":case-2:d.setFullYear(d.getFullYear()-1);break;case"+Y":case 2:d.setFullYear(d.getFullYear()+1);break;case"-M":case-1:d.setMonth(d.getMonth()-1);break;case"+M":case 1:d.setMonth(d.getMonth()+1)}else d=new Date;return a.moveTo(d,!c)}function o(a,b){a._menuVisible=b,N(b,a.els.title,"DynarchCalendar-pressed-title");var c=a.els.menu;if(cb&&(c.style.height=a.els.main.offsetHeight+"px"),a.args.animation){a._menuAnim&&a._menuAnim.stop();var d=a.els.main.offsetHeight;cb&&(c.style.width=a.els.topBar.offsetWidth+"px"),b&&(c.firstChild.style.marginTop=-d+"px",a.args.opacity>0&&T(c,0),U(c,!0)),a._menuAnim=S({onUpdate:function(e,f){c.firstChild.style.marginTop=f(lb.accel_b(e),-d,0,!b)+"px",a.args.opacity>0&&T(c,f(lb.accel_b(e),0,.85,!b))},onStop:function(){a.args.opacity>0&&T(c,.85),c.firstChild.style.marginTop="",a._menuAnim=null,b||(U(c,!1),a.focused&&a.focus())}})}else U(c,b),a.focused&&a.focus()}function p(b,c){c=c||window.event;var d=r(c);if(d&&!d.getAttribute("disabled")){var e,f=d.getAttribute("dyc-btn"),g=d.getAttribute("dyc-type"),h=d.getAttribute("dyc-date"),i=this.selection,j={mouseover:K,mousemove:K,mouseup:function(){var a=d.getAttribute("dyc-cls");a&&L(d,s(a,1)),clearTimeout(e),J(document,j,!0),j=null}};if(b){setTimeout(Q(this.focus,this),1);var k=d.getAttribute("dyc-cls");if(k&&M(d,s(k,1)),"menu"==f)this.toggleMenu();else if(d&&/^[+-][MY]$/.test(f))if(n(this,f)){var l=Q(function(){n(this,f,!0)?e=setTimeout(l,40):(j.mouseup(),n(this,f))},this);e=setTimeout(l,350),I(document,j,!0)}else j.mouseup();else if("year"==f)this.els.yearInput.focus(),this.els.yearInput.select();else if("time-am"==g)I(document,j,!0);else if(/^time/.test(g)){var l=Q(function(a){m.call(this,a),e=setTimeout(l,100)},this,g);m.call(this,g),e=setTimeout(l,350),I(document,j,!0)}else h&&i.type&&(i.type==a.SEL_MULTIPLE?c.shiftKey&&this._selRangeStart?i.selectRange(this._selRangeStart,h):(c.ctrlKey||i.isSelected(h)||i.clear(!0),i.set(h,!0),this._selRangeStart=h):(i.set(h),this.moveTo(C(h),2)),d=this._getDateDiv(h),t.call(this,!0,{target:d})),I(document,j,!0);bb&&j&&/dbl/i.test(c.type)&&j.mouseup(),/^(DynarchCalendar-(topBar|bottomBar|weekend|weekNumber|menu(-sep)?))?$/.test(d.className)&&!this.args.cont&&(j.mousemove=Q(q,this),this._mouseDiff=V(c,W(this.els.topCont)),I(document,j,!0))}else if("today"==f)this._menuVisible||i.type!=a.SEL_SINGLE||i.set(new Date),this.moveTo(new Date,!0),o(this,!1);else if(/^m([0-9]+)/.test(f)){var h=new Date(this.date);h.setDate(1),h.setMonth(RegExp.$1),h.setFullYear(this._getInputYear()),this.moveTo(h,!0),o(this,!1)}else"time-am"==g&&this.setHours(this.getHours()+12);bb||K(c)}}function q(a){a=a||window.event;var b=this.els.topCont.style,c=V(a,this._mouseDiff);b.left=c.x+"px",b.top=c.y+"px"}function r(a){for(var b=a.target||a.srcElement,c=b;b&&b.getAttribute&&!b.getAttribute("dyc-type");)b=b.parentNode;return b.getAttribute&&b||c}function s(a,b){return"DynarchCalendar-"+a.split(/,/)[b]}function t(a,b){b=b||window.event;var c=r(b);if(c){var d=c.getAttribute("dyc-type");if(!(!d||c.getAttribute("disabled")||a&&this._bodyAnim&&"date"==d)){var e=c.getAttribute("dyc-cls");e=e?s(e,0):"DynarchCalendar-hover-"+d,("date"!=d||this.selection.type)&&N(a,c,e),"date"==d&&(N(a,c.parentNode.parentNode,"DynarchCalendar-hover-week"),this._showTooltip(c.getAttribute("dyc-date"))),/^time-hour/.test(d)&&N(a,this.els.timeHour,"DynarchCalendar-hover-time"),/^time-min/.test(d)&&N(a,this.els.timeMinute,"DynarchCalendar-hover-time"),L(this._getDateDiv(this._lastHoverDate),"DynarchCalendar-hover-date"),this._lastHoverDate=null}}a||this._showTooltip()}function u(a){a=a||window.event;var b=r(a);if(b){var c=b.getAttribute("dyc-btn"),d=b.getAttribute("dyc-type"),e=a.wheelDelta?a.wheelDelta/120:-a.detail/3;if(e=0>e?-1:e>0?1:0,this.args.reverseWheel&&(e=-e),/^(time-(hour|min))/.test(d)){switch(RegExp.$1){case"time-hour":this.setHours(this.getHours()+e);break;case"time-min":this.setMinutes(this.getMinutes()+this.args.minuteStep*e)}K(a)}else/Y/i.test(c)&&(e*=2),n(this,-e),K(a)}}function v(){this.refresh();var a=this.inputField,b=this.selection;if(a){var c=b.print(this.dateFormat);/input|textarea/i.test(a.tagName)?a.value=c:a.innerHTML=c}this.callHooks("onSelect",this,b)}function w(b){if(!this._menuAnim){b=b||window.event;var c=b.target||b.srcElement,d=c.getAttribute("dyc-btn"),e=b.keyCode,f=b.charCode||e,g=jb[e];if("year"==d&&13==e){var h=new Date(this.date);return h.setDate(1),h.setFullYear(this._getInputYear()),this.moveTo(h,!0),o(this,!1),K(b)}if(this._menuVisible){if(27==e)return o(this,!1),K(b)}else{if(b.ctrlKey||(g=null),null!=g||b.ctrlKey||(g=kb[e]),36==e&&(g=0),null!=g)return n(this,g),K(b);f=String.fromCharCode(f).toLowerCase();var i=this.els.yearInput,j=this.selection;if(" "==f)return o(this,!0),this.focus(),i.focus(),i.select(),K(b);if(f>="0"&&"9">=f)return o(this,!0),this.focus(),i.value=f,i.focus(),K(b);for(var k,l=y("mn"),m=b.shiftKey?-1:this.date.getMonth(),p=0;++p<12;)if(k=l[(m+p)%12].toLowerCase(),0==k.indexOf(f)){var h=new Date(this.date);return h.setDate(1),h.setMonth((m+p)%12),this.moveTo(h,!0),K(b)}if(e>=37&&40>=e){var h=this._lastHoverDate;if(h||j.isEmpty()||(h=39>e?j.getFirstDate():j.getLastDate(),(h<this._firstDateVisible||h>this._lastDateVisible)&&(h=null)),h){var q=h;h=C(h);for(var m=100;m-->0;){switch(e){case 37:h.setDate(h.getDate()-1);break;case 38:h.setDate(h.getDate()-7);break;case 39:h.setDate(h.getDate()+1);break;case 40:h.setDate(h.getDate()+7)}if(!this.isDisabled(h))break}h=B(h),(h<this._firstDateVisible||h>this._lastDateVisible)&&this.moveTo(h)}else h=39>e?this._lastDateVisible:this._firstDateVisible;return L(this._getDateDiv(q),M(this._getDateDiv(h),"DynarchCalendar-hover-date")),this._lastHoverDate=h,K(b)}if(13==e&&this._lastHoverDate)return j.type==a.SEL_MULTIPLE&&(b.shiftKey||b.ctrlKey)?(b.shiftKey&&this._selRangeStart&&(j.clear(!0),j.selectRange(this._selRangeStart,this._lastHoverDate)),b.ctrlKey&&j.set(this._selRangeStart=this._lastHoverDate,!0)):j.reset(this._selRangeStart=this._lastHoverDate),K(b);27!=e||this.args.cont||this.hide()}}}function x(a,b){return a.replace(/\$\{([^:\}]+)(:[^\}]+)?\}/g,function(a,c,d){var e,f=b[c];return d&&(e=d.substr(1).split(/\s*\|\s*/),f=(f>=e.length?e[e.length-1]:e[f]).replace(/##?/g,function(a){return 2==a.length?"#":f})),f})}function y(a,b){var c=fb.__.data[a];return b&&"string"==typeof c&&(c=x(c,b)),c}function z(a){a=new Date(a.getFullYear(),a.getMonth(),a.getDate(),12,0,0);var b=a.getDay();a.setDate(a.getDate()-(b+6)%7+3);var c=a.valueOf();return a.setMonth(0),a.setDate(4),Math.round((c-a.valueOf())/6048e5)+1}function A(a){a=new Date(a.getFullYear(),a.getMonth(),a.getDate(),12,0,0);var b=new Date(a.getFullYear(),0,1,12,0,0),c=a-b;return Math.floor(c/864e5)}function B(a){return a instanceof Date?1e4*a.getFullYear()+100*(a.getMonth()+1)+a.getDate():"string"==typeof a?parseInt(a,10):a}function C(a,b,c,d,e){if(!(a instanceof Date)){a=parseInt(a,10);var f=Math.floor(a/1e4);a%=1e4;var g=Math.floor(a/100);a%=100,a=new Date(f,g-1,a,b||12,c||0,d||0,e||0)}return a}function D(a,b,c){var d=a.getFullYear(),e=a.getMonth(),f=a.getDate(),g=b.getFullYear(),h=b.getMonth(),i=b.getDate();return g>d?-3:d>g?3:h>e?-2:e>h?2:c?0:i>f?-1:f>i?1:0}function E(a,b){var c,d=a.getMonth(),e=a.getDate(),f=a.getFullYear(),g=z(a),h=a.getDay(),i=a.getHours(),j=i>=12,k=j?i-12:i,l=A(a),m=a.getMinutes(),n=a.getSeconds(),o=/%./g;return 0===k&&(k=12),c={"%a":y("sdn")[h],"%A":y("dn")[h],"%b":y("smn")[d],"%B":y("mn")[d],"%C":1+Math.floor(f/100),"%d":10>e?"0"+e:e,"%e":e,"%H":10>i?"0"+i:i,"%I":10>k?"0"+k:k,"%j":10>l?"00"+l:100>l?"0"+l:l,"%k":i,"%l":k,"%m":9>d?"0"+(1+d):1+d,"%o":1+d,"%M":10>m?"0"+m:m,"%n":"\n","%p":j?"PM":"AM","%P":j?"pm":"am","%s":Math.floor(a.getTime()/1e3),"%S":10>n?"0"+n:n,"%t":"	","%U":10>g?"0"+g:g,"%W":10>g?"0"+g:g,"%V":10>g?"0"+g:g,"%u":h+1,"%w":h,"%y":(""+f).substr(2,2),"%Y":f,"%%":"%"},b.replace(o,function(a){return c.hasOwnProperty(a)?c[a]:a})}function F(a){if(a){if("number"==typeof a)return C(a);if(!(a instanceof Date)){var b=a.split(/-/);return new Date(parseInt(b[0],10),parseInt(b[1],10)-1,parseInt(b[2],10),12,0,0,0)}}return a}function G(a){function b(b){for(var c=b.length;--c>=0;)if(0==b[c].toLowerCase().indexOf(a))return c}if(/\S/.test(a)){a=a.toLowerCase();var c=b(y("smn"))||b(y("mn"));return null!=c&&c++,c}}function H(a,b,c,d){d={};for(c in b)b.hasOwnProperty(c)&&(d[c]=b[c]);for(c in a)a.hasOwnProperty(c)&&(d[c]=a[c]);return d}function I(a,b,c,d){if(a instanceof Array)for(var e=a.length;--e>=0;)I(a[e],b,c,d);else if("object"==typeof b)for(var e in b)b.hasOwnProperty(e)&&I(a,e,b[e],c);else a.addEventListener?a.addEventListener(b,c,bb?!0:!!d):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c}function J(a,b,c,d){if(a instanceof Array)for(var e=a.length;--e>=0;)J(a[e],b,c);else if("object"==typeof b)for(var e in b)b.hasOwnProperty(e)&&J(a,e,b[e],c);else a.removeEventListener?a.removeEventListener(b,c,bb?!0:!!d):a.detachEvent?a.detachEvent("on"+b,c):a["on"+b]=null}function K(a){return a=a||window.event,bb?(a.cancelBubble=!0,a.returnValue=!1):(a.preventDefault(),a.stopPropagation()),!1}function L(a,b,c){if(a){var d,e=a.className.replace(/^\s+|\s+$/,"").split(/\x20/),f=[];for(d=e.length;d>0;)e[--d]!=b&&f.push(e[d]);c&&f.push(c),a.className=f.join(" ")}return c}function M(a,b){return L(a,b,b)}function N(a,b,c){if(b instanceof Array)for(var d=b.length;--d>=0;)N(a,b[d],c);else L(b,c,a?c:null);return a}function O(a,b,c){var d=null;return d=document.createElementNS?document.createElementNS("http://www.w3.org/1999/xhtml",a):document.createElement(a),b&&(d.className=b),c&&c.appendChild(d),d}function P(a,b){null==b&&(b=0);var c,d,e;try{c=Array.prototype.slice.call(a,b)}catch(f){for(c=new Array(a.length-b),d=b,e=0;d<a.length;++d,++e)c[e]=a[d]}return c}function Q(a,b){var c=P(arguments,2);return void 0==b?function(){return a.apply(this,c.concat(P(arguments)))}:function(){return a.apply(b,c.concat(P(arguments)))}}function R(a,b){if(!b(a))for(var c=a.firstChild;c;c=c.nextSibling)1==c.nodeType&&R(c,b)}function S(a,b,c){function d(a,b,c,d){return d?c+a*(b-c):b+a*(c-b)}function e(){b&&f(),c=0,b=setInterval(g,1e3/a.fps)}function f(){b&&(clearInterval(b),b=null),a.onStop(c/a.len,d)}function g(){var b=a.len;a.onUpdate(c/b,d),c==b&&f(),++c}return a=H(a,{fps:50,len:15,onUpdate:mb,onStop:mb}),bb&&(a.len=Math.round(a.len/2)),e(),{start:e,stop:f,update:g,args:a,map:d}}function T(a,b){return""===b?bb?a.style.filter="":a.style.opacity="":null!=b?bb?a.style.filter="alpha(opacity="+100*b+")":a.style.opacity=b:bb?/alpha\(opacity=([0-9.])+\)/.test(a.style.opacity)&&(b=parseFloat(RegExp.$1)/100):b=parseFloat(a.style.opacity),b}function U(a,b){var c=a.style;return null!=b&&(c.display=b?"":"none"),"none"!=c.display}function V(a,b){var c=bb?a.clientX+document.body.scrollLeft:a.pageX,d=bb?a.clientY+document.body.scrollTop:a.pageY;return b&&(c-=b.x,d-=b.y),{x:c,y:d}}function W(a){var b,c,d=0,e=0,f=/^div$/i.test(a.tagName);return f&&a.scrollLeft&&(d=a.scrollLeft),f&&a.scrollTop&&(e=a.scrollTop),b={x:a.offsetLeft-d,y:a.offsetTop-e},a.offsetParent&&(c=W(a.offsetParent),b.x+=c.x,b.y+=c.y),b}function X(){var a=document.documentElement,b=document.body;return{x:a.scrollLeft||b.scrollLeft,y:a.scrollTop||b.scrollTop,w:a.clientWidth||window.innerWidth||b.clientWidth,h:a.clientHeight||window.innerHeight||b.clientHeight}}function Y(a,b,c){for(c=0;c<a.length;++c)b(a[c])}function Z(a){return"string"==typeof a&&(a=document.getElementById(a)),a}var $=navigator.userAgent,_=/opera/i.test($),ab=/Konqueror|Safari|KHTML/i.test($),bb=/msie/i.test($)&&!_&&!/mac_powerpc/i.test($),cb=bb&&/msie 6/i.test($),db=/gecko/i.test($)&&!ab&&!_&&!bb,eb=a.prototype,fb=a.I18N={};a.SEL_NONE=0,a.SEL_SINGLE=1,a.SEL_MULTIPLE=2,a.SEL_WEEK=3,a.dateToInt=B,a.intToDate=C,a.printDate=E,a.formatString=x,a.i18n=y,a.LANG=function(a,b,c){fb.__=fb[a]={name:b,data:c}},a.setup=function(b){return new a(b)},eb.moveTo=function(a,b){a=F(a);var d,e=D(a,this.date,!0),f=this.args,g=f.min&&D(a,f.min),h=f.max&&D(a,f.max);if(f.showTime&&(this.setHours(a.getUTCHours()),this.setMinutes(a.getUTCMinutes())),f.animation||(b=!1),N(null!=g&&1>=g,[this.els.navPrevMonth,this.els.navPrevYear],"DynarchCalendar-navDisabled"),N(null!=h&&h>=-1,[this.els.navNextMonth,this.els.navNextYear],"DynarchCalendar-navDisabled"),-1>g&&(a=f.min,d=1,e=0),h>1&&(a=f.max,d=2,e=0),this.date=a,this.refresh(!!b),this.callHooks("onChange",this,a,b),b&&(0!=e||2!=b)){this._bodyAnim&&this._bodyAnim.stop();var i=this.els.body,j=O("div","DynarchCalendar-animBody-"+ib[e],i),k=i.firstChild,l=(T(k)||.7,d?lb.brakes:0==e?lb.shake:lb.accel_ab2),m=e*e>4,n=m?k.offsetTop:k.offsetLeft,o=j.style,p=m?i.offsetHeight:i.offsetWidth;if(0>e?p+=n:e>0?p=n-p:(p=Math.round(p/7),2==d&&(p=-p)),!d&&0!=e){var q=j.cloneNode(!0),r=q.style,s=2*p;q.appendChild(k.cloneNode(!0)),r[m?"marginTop":"marginLeft"]=p+"px",i.appendChild(q)}k.style.visibility="hidden",j.innerHTML=c(this),this._bodyAnim=S({onUpdate:Q(function(a,b){var c=l(a);if(q)var f=b(c,p,s)+"px";d?o[m?"marginTop":"marginLeft"]=b(c,p,0)+"px":((m||0==e)&&(o.marginTop=b(0==e?l(a*a):c,0,p)+"px",0!=e&&(r.marginTop=f)),m&&0!=e||(o.marginLeft=b(c,0,p)+"px",0!=e&&(r.marginLeft=f))),this.args.opacity>2&&q&&(T(q,1-c),T(j,c))},this),onStop:Q(function(){i.innerHTML=c(this,a),this._bodyAnim=null},this)})}return this._lastHoverDate=null,g>=-1&&1>=h},eb.isDisabled=function(a){var b=this.args;return b.min&&D(a,b.min)<0||b.max&&D(a,b.max)>0||b.disabled(a)},eb.toggleMenu=function(){o(this,!this._menuVisible)},eb.refresh=function(a){var b=this.els;a||(b.body.innerHTML=c(this)),b.title.innerHTML=e(this),b.yearInput.value=this.date.getFullYear()},eb.redraw=function(){var a=this.els;this.refresh(),a.dayNames.innerHTML=b(this),a.menu.innerHTML=f(this),a.bottomBar&&(a.bottomBar.innerHTML=h(this)),R(a.topCont,Q(function(b){var c=hb[b.className];c&&(a[c]=b),"DynarchCalendar-menu-year"==b.className?(I(b,this._focusEvents),a.yearInput=b):bb&&b.setAttribute("unselectable","on")},this)),this.setTime(null,!0)},eb.setLanguage=function(b){var c=a.setLanguage(b);c&&(this.fdow=c.data.fdow,this.redraw())},a.setLanguage=function(a){var b=fb[a];return b&&(fb.__=b),b},eb.focus=function(){try{this.els[this._menuVisible?"yearInput":"focusLink"].focus()}catch(a){}j.call(this)},eb.blur=function(){this.els.focusLink.blur(),this.els.yearInput.blur(),k.call(this)},eb.showAt=function(a,b,c){this._showAnim&&this._showAnim.stop(),c=c&&this.args.animation;var d=this.els.topCont,e=this,f=this.els.body.firstChild,g=f.offsetHeight,h=d.style;h.position="absolute",h.left=a+"px",h.top=b+"px",h.zIndex=1e4,h.display="",c&&(f.style.marginTop=-g+"px",this.args.opacity>1&&T(d,0),this._showAnim=S({onUpdate:function(a,b){f.style.marginTop=-b(lb.accel_b(a),g,0)+"px",e.args.opacity>1&&T(d,a)},onStop:function(){e.args.opacity>1&&T(d,""),e._showAnim=null}}))},eb.hide=function(){var a=this.els.topCont,b=this,c=this.els.body.firstChild,d=c.offsetHeight,e=W(a).y;this.args.animation?(this._showAnim&&this._showAnim.stop(),this._showAnim=S({onUpdate:function(f,g){b.args.opacity>1&&T(a,1-f),c.style.marginTop=-g(lb.accel_b(f),0,d)+"px",a.style.top=g(lb.accel_ab(f),e,e-10)+"px"},onStop:function(){a.style.display="none",c.style.marginTop="",b.args.opacity>1&&T(a,""),b._showAnim=null}})):a.style.display="none",this.inputField=null},eb.popup=function(a,b){function c(b){var c={x:i.x,y:i.y};return b?(/B/.test(b)&&(c.y+=a.offsetHeight),/b/.test(b)&&(c.y+=a.offsetHeight-d.y),/T/.test(b)&&(c.y-=d.y),/l/.test(b)&&(c.x-=d.x-a.offsetWidth),/L/.test(b)&&(c.x-=d.x),/R/.test(b)&&(c.x+=a.offsetWidth),/c/i.test(b)&&(c.x+=(a.offsetWidth-d.x)/2),/m/i.test(b)&&(c.y+=(a.offsetHeight-d.y)/2),c):c}a=Z(a),b||(b=this.args.align),b=b.split(/\x2f/);var d,e=W(a),f=this.els.topCont,g=f.style,h=X();g.visibility="hidden",g.display="",this.showAt(0,0),document.body.appendChild(f),d={x:f.offsetWidth,y:f.offsetHeight};var i=e;i=c(b[0]),i.y<h.y&&(i.y=e.y,i=c(b[1])),i.x+d.x>h.x+h.w&&(i.x=e.x,i=c(b[2])),i.y+d.y>h.y+h.h&&(i.y=e.y,i=c(b[3])),i.x<h.x&&(i.x=e.x,i=c(b[4])),this.showAt(i.x,i.y,!0),g.visibility="",this.focus()},eb.manageFields=function(b,c,d){c=Z(c),I(Z(b),"click",Q(function(){if(this.inputField=c,this.dateFormat=d,this.selection.type==a.SEL_SINGLE){var e,f,g,h;e=/input|textarea/i.test(c.tagName)?c.value:c.innerText||c.textContent,e&&(f=/(^|[^%])%[bBmo]/.exec(d),g=/(^|[^%])%[de]/.exec(d),f&&g&&(h=f.index<g.index),e=Calendar.parseDate(e,h),e&&(this.selection.set(e,!1,!0),this.moveTo(e)))}this.popup(b)},this))},eb.callHooks=function(a){for(var b=P(arguments,1),c=this.handlers[a],d=0;d<c.length;++d)c[d].apply(this,b)},eb.addEventListener=function(a,b){this.handlers[a].push(b)},eb.removeEventListener=function(a,b){for(var c=this.handlers[a],d=c.length;--d>=0;)c[d]===b&&c.splice(d,1)},eb.getTime=function(){return this.time},eb.setTime=function(a,b){if(this.args.showTime){a=this.time=null!=a?a:this.time;var c=this.getHours(),d=this.getMinutes(),e=12>c;12==this.args.showTime&&(0==c&&(c=12),c>12&&(c-=12),this.els.timeAM.innerHTML=y(e?"AM":"PM")),10>c&&(c="0"+c),10>d&&(d="0"+d),this.els.timeHour.innerHTML=c,this.els.timeMinute.innerHTML=d,b||this.callHooks("onTimeChange",this,a)}},eb.getHours=function(){return Math.floor(this.time/100)},eb.getMinutes=function(){return this.time%100},eb.setHours=function(a){0>a&&(a+=24),this.setTime(100*(a%24)+this.time%100)},eb.setMinutes=function(a){0>a&&(a+=60),this.setTime(100*this.getHours()+a%60)},eb._getInputYear=function(){var a=parseInt(this.els.yearInput.value,10);return isNaN(a)&&(a=this.date.getFullYear()),a},eb._showTooltip=function(a){var b,c="",d=this.els.tooltip;a&&(a=C(a),b=this.args.dateInfo(a),b&&b.tooltip&&(c="<div class='DynarchCalendar-tooltipCont'>"+E(a,b.tooltip)+"</div>")),d.innerHTML=c};var gb=" align='center' cellspacing='0' cellpadding='0'",hb={"DynarchCalendar-topCont":"topCont","DynarchCalendar-focusLink":"focusLink",DynarchCalendar:"main","DynarchCalendar-topBar":"topBar","DynarchCalendar-title":"title","DynarchCalendar-dayNames":"dayNames","DynarchCalendar-body":"body","DynarchCalendar-menu":"menu","DynarchCalendar-menu-year":"yearInput","DynarchCalendar-bottomBar":"bottomBar","DynarchCalendar-tooltip":"tooltip","DynarchCalendar-time-hour":"timeHour","DynarchCalendar-time-minute":"timeMinute","DynarchCalendar-time-am":"timeAM","DynarchCalendar-navBtn DynarchCalendar-prevYear":"navPrevYear","DynarchCalendar-navBtn DynarchCalendar-nextYear":"navNextYear","DynarchCalendar-navBtn DynarchCalendar-prevMonth":"navPrevMonth","DynarchCalendar-navBtn DynarchCalendar-nextMonth":"navNextMonth"},ib={"-3":"backYear","-2":"back",0:"now",2:"fwd",3:"fwdYear"},jb={37:-1,38:-2,39:1,40:2},kb={33:-1,34:1};eb._getDateDiv=function(a){var b=null;if(a)try{R(this.els.body,function(c){if(c.getAttribute("dyc-date")==a)throw b=c})}catch(c){}return b},(a.Selection=function(a,b,c,d){this.type=b,this.sel=a instanceof Array?a:[a],this.onChange=Q(c,d),this.cal=d}).prototype={get:function(){return this.type==a.SEL_SINGLE?this.sel[0]:this.sel},isEmpty:function(){return 0==this.sel.length},set:function(b,c,d){var e=this.type==a.SEL_SINGLE;b instanceof Array?(this.sel=b,this.normalize(),d||this.onChange(this)):(b=B(b),e||!this.isSelected(b)?(e?this.sel=[b]:this.sel.splice(this.findInsertPos(b),0,b),this.normalize(),d||this.onChange(this)):c&&this.unselect(b,d))},reset:function(){this.sel=[],this.set.apply(this,arguments)},countDays:function(){for(var a,b,c,d=0,e=this.sel,f=e.length;--f>=0;)a=e[f],a instanceof Array&&(b=C(a[0]),c=C(a[1]),d+=Math.round(Math.abs(c.getTime()-b.getTime())/864e5)),++d;return d},unselect:function(a,b){a=B(a);for(var c,d=!1,e=this.sel,f=e.length;--f>=0;)if(c=e[f],c instanceof Array){if(a>=c[0]&&a<=c[1]){var g=C(a),h=g.getDate();if(a==c[0])g.setDate(h+1),c[0]=B(g),d=!0;else if(a==c[1])g.setDate(h-1),c[1]=B(g),d=!0;else{var i=new Date(g);i.setDate(h+1),g.setDate(h-1),e.splice(f+1,0,[B(i),c[1]]),c[1]=B(g),d=!0}}}else a==c&&(e.splice(f,1),d=!0);d&&(this.normalize(),b||this.onChange(this))},normalize:function(){this.sel=this.sel.sort(function(a,b){return a instanceof Array&&(a=a[0]),b instanceof Array&&(b=b[0]),a-b});for(var a,b,c=this.sel,d=c.length;--d>=0;){if(a=c[d],a instanceof Array){if(a[0]>a[1]){c.splice(d,1);continue}a[0]==a[1]&&(a=c[d]=a[0])}if(b){var e=b,f=a instanceof Array?a[1]:a;if(f=C(f),f.setDate(f.getDate()+1),f=B(f),f>=e){var g=c[d+1];a instanceof Array&&g instanceof Array?(a[1]=g[1],c.splice(d+1,1)):a instanceof Array?(a[1]=b,c.splice(d+1,1)):g instanceof Array?(g[0]=a,c.splice(d,1)):(c[d]=[a,g],c.splice(d+1,1))}}b=a instanceof Array?a[0]:a}},findInsertPos:function(a){for(var b,c=this.sel,d=c.length;--d>=0&&(b=c[d],b instanceof Array&&(b=b[0]),!(a>=b)););return d+1},clear:function(a){this.sel=[],a||this.onChange(this)},selectRange:function(b,c){if(b=B(b),c=B(c),b>c){var d=b;b=c,c=d}var e=this.cal.args.checkRange;if(!e)return this._do_selectRange(b,c);try{Y(new a.Selection([[b,c]],a.SEL_MULTIPLE,mb).getDates(),Q(function(a){if(this.isDisabled(a))throw e instanceof Function&&e(a,this),"OUT"},this.cal)),this._do_selectRange(b,c)}catch(f){}},_do_selectRange:function(a,b){this.sel.push([a,b]),this.normalize(),this.onChange(this)},isSelected:function(a){for(var b,c=this.sel.length;--c>=0;)if(b=this.sel[c],b instanceof Array&&a>=b[0]&&a<=b[1]||a==b)return!0;return!1},getFirstDate:function(){var a=this.sel[0];return a&&a instanceof Array&&(a=a[0]),a},getLastDate:function(){if(this.sel.length>0){var a=this.sel[this.sel.length-1];return a&&a instanceof Array&&(a=a[1]),a}},print:function(a,b){var c,d=[],e=0,f=this.cal.getHours(),g=this.cal.getMinutes();for(b||(b=" -> ");e<this.sel.length;)c=this.sel[e++],d.push(c instanceof Array?E(C(c[0],f,g),a)+b+E(C(c[1],f,g),a):E(C(c,f,g),a));return d},getDates:function(a){for(var b,c,d=[],e=0;e<this.sel.length;){if(c=this.sel[e++],c instanceof Array)for(b=C(c[0]),c=c[1];B(b)<c;)d.push(a?E(b,a):new Date(b)),b.setDate(b.getDate()+1);else b=C(c);d.push(a?E(b,a):b)}return d}},a.parseDate=function(a,b,c){if(!/\S/.test(a))return"";a=a.replace(/^\s+/,"").replace(/\s+$/,""),c=c||new Date;var d=null,e=null,f=null,g=null,h=null,i=null,j=a.match(/([0-9]{1,2}):([0-9]{1,2})(:[0-9]{1,2})?\s*(am|pm)?/i);j&&(g=parseInt(j[1],10),h=parseInt(j[2],10),i=j[3]?parseInt(j[3].substr(1),10):0,a=a.substring(0,j.index)+a.substr(j.index+j[0].length),j[4]&&("pm"==j[4].toLowerCase()&&12>g?g+=12:"am"==j[4].toLowerCase()&&g>=12&&(g-=12)));for(var k=a.split(/\W+/),l=[],m=0;m<k.length;++m){var n=k[m];/^[0-9]{4}$/.test(n)?(d=parseInt(n,10),e||f||null!=b||(b=!0)):/^[0-9]{1,2}$/.test(n)?(n=parseInt(n,10),n>=60?d=n:n>=0&&12>=n?l.push(n):n>=1&&31>=n&&(f=n)):e=G(n)}return l.length>=2?b?(e||(e=l.shift()),f||(f=l.shift())):(f||(f=l.shift()),e||(e=l.shift())):1==l.length&&(f?e||(e=l.shift()):f=l.shift()),d||(d=l.length>0?l.shift():c.getFullYear()),30>d?d+=2e3:99>d&&(d+=1900),e||(e=c.getMonth()+1),d&&e&&f?new Date(Date.UTC(d,e-1,f,g,h,i)):null};var lb={elastic_b:function(a){return 1-Math.cos(5.5*-a*Math.PI)/Math.pow(2,7*a)},magnetic:function(a){return 1-Math.cos(a*a*a*10.5*Math.PI)/Math.exp(4*a)},accel_b:function(a){return a=1-a,1-a*a*a*a},accel_a:function(a){return a*a*a},accel_ab:function(a){return a=1-a,1-Math.sin(a*a*Math.PI/2)},accel_ab2:function(a){return(a/=.5)<1?.5*a*a:-0.5*(--a*(a-2)-1)},brakes:function(a){return a=1-a,1-Math.sin(a*a*Math.PI)},shake:function(a){return.5>a?-Math.cos(11*a*Math.PI)*a*a:(a=1-a,Math.cos(11*a*Math.PI)*a*a)}},mb=new Function;return a}();