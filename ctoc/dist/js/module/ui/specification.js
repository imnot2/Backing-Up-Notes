Ymt.add(function(){function a(d,e){return this instanceof a?(this.container=document.getElementById(d),this.config=e,this._index=b++,void this._init()):new a(d,$m.merge(c,e))}var b=0,c={normal:"normal",hover:"hover",disabled:"disabled",content:"specontent",spe:{},callback:"",canBuyBtn:"#CanBuyDiv",cantBuyBtn:"#CantBuyDiv",oversaleBox:"#oversale",specBox:".p_box",stock:".spestock",countdownnumber:0,price:".price",promotionPrice:".speprice",limitNum:".spelimit",complete:null,Flight:".speflight",id:"specification_",parent:".propwapper",tobuy:1,totalStock:0,spedata:null};return $m.augment(a,{_init:function(){this._parseJSON(),this._prepareHTML(),this._control()},_parseJSON:function(){function a(a){var b=[];for(var c in a)b.push(a[c]);return b}function b(a){for(var b,c,d=a.length,e=0;d>e;e++){c=a[e];for(var f=d-1;f>=0;f--)b=a[f],e!=f&&$m.each(c.map,function(a,c,d){this.each(b.map,function(b,e){var f;if("un"!=c&&"un"!=e){var g=this,h=function(a,b){var c,d,e=a.length;for(d=0;e>d;d++)if(c=g.inArray(a[d],b))return!0;return c}(a,b);h||(f=d.un=d.un||{},f[c+"-un"]=f[c+"-un"]||[],f[c+"-un"].push(e))}},this)},$m)}return a}var c,d=this.config,e=this,f=d.spedata;$m.each(f.Spec,function(a,b){var c=d.spe[""+b]={},g="";c.name=f.Spec[b],$m.each(f.Data,function(a,d){var h=f.Data[d].SpecDetail,i=a.CatalogId;e.length=h.length,$m.each(h,function(a,d){if(b==d){var f=c.sub=c.sub||[],h=c.map=c.map||{};!$m.inArray(a,f)&&f.push(a),g=e._unicode(b,a),h[g]=h[g]||[],h[g].push(i)}})})}),c=a(d.spe),c=b(c)},_prepareHTML:function(){var a=this.config,b=this,c=document.createElement("div"),d="";c.className=a.content,$m.each(a.spe,function(c,e){d+="<dl id='"+a.id+b._index+"-"+e+"' class='colorBox clearfix'><dt class='name'>"+c.name+"ï¼š</dt><dd class='colorListBox des'><ul class='colorList'>",$m.each(c.sub,function(a){var c=b._unicode(e,a);a.indexOf("|")>0?(a=a.split("|"),a="null"!=a[0]?"<img src='"+a[0]+"' height='24' title='"+a[1]+"' />":a[1]):a=a,d+="<li class='item'><a href='javascript:;'  map='"+c+"'><span>"+a+"</span></a></li>"}),d+="</ul></dd></dl>"}),c.innerHTML=d,$(this.container).find(".buyOperationBox").children(":first-child").before(c)},_unicode:function(a,b){return b=b.indexOf("|")&&b.split("|")[1]||b,encodeURIComponent(a+b.slice())},_model:function(a,b){var c,d=b.spe[0].map[a[0]],e=b.spe[1];if(e){e=e.map[a[1]];for(var f=0,g=d.length;g>f;f++)for(var h=0,i=e.length;i>h;h++)d[f]==e[h]&&(c=d[f])}else c=d[0];for(var j in b.spedata.Data)if(b.spedata.Data[j].CatalogId==c)return b.spedata.Data[j]},_view:function(a,b){function c(a){var b;return e.spedata.CanBuy&&a.Stock>0?(f._show(d.canBuyBtn,d.cantBuyBtn),b=!0):(f._show(d.cantBuyBtn,d.canBuyBtn),b=!1),b}var d,e=this.config,f=this,g=window.$,h=g(this.container).closest(e.parent),i=!1;if(d=e.ui=e.ui||{canBuyBtn:h.find(e.canBuyBtn),cantBuyBtn:h.find(e.cantBuyBtn),stock:h.find(e.stock),price:h.find(e.price),promotionPrice:h.find(e.promotionPrice),limitNum:h.find(e.limitNum),Flight:h.find(e.Flight),oversaleBox:h.find(e.oversaleBox),specBox:h.find(e.specBox)},void 0!=a&&""!=a)return!i&&c(a),b?(d.stock.html(e.totalStock),d.stock.parent().hide(),e.totalStock<=10&&d.stock.parent().show()):(d.stock.html(a.Stock),d.stock.parent().hide(),a.Stock<=10&&d.stock.parent().show()),d.price.html(a.Price),a.PromotionPrice&&d.promotionPrice.html(a.PromotionPrice).parents(".promotion").show(),d.limitNum.html(a.Limit-a.Bought),(0==a.Limit||"0"==a.Limit)&&d.limitNum.closest("span").hide(),e.complete&&e.complete(a),d.Flight.html(a.Flight),a;if(!e.spedata.Data.length)return f._show(d.oversaleBox,d.specBox),void f._show(d.cantBuyBtn,d.canBuyBtn);for(var j=0,k=e.spedata.Data.length;k>j;j++)if(i=c(e.spedata.Data[j]))return f._view(e.spedata.Data[j],b),e.spedata.Data[j]},_show:function(a,b){var c=this.config.countdownnumber,d=this;if(0==c)return a.show(),void b.hide();if(c>0){var e=null;$("#countdown").show(),e=setInterval(function(){var f=$("#countdown");if(0==c)return clearInterval(e),f.hide(),a.show(),b.hide(),void(d.config.countdownnumber=0);var g,h,i,j,k=[];g=c%60,j=(c-g)/60,h=j%60,i=(j-h)/60,g=g>9?g:"0"+g,h=h>9?h:"0"+h,i=i>9?i:"0"+i,k.push(i,h,g),f.find(".time").text(k.join(" : ")),c--},1e3)}},_control:function(){function a(){var a=d(this),c=d(a).attr("map"),e=parseInt(c.slice(0,1)),h=g[0],i=g[1],j=b.spe[e+""].map.un&&b.spe[e+""].map.un[c+"-un"],k=d(i.container).find("dl"),l=k.find("a."+b.disabled);if(!a.hasClass(b.disabled)){b.callback&&b.callback.call(b,c,a),a.hasClass("hover")?(a.removeClass("hover"),h[e]=0,l.removeClass(b.disabled)):(d("#"+b.id+i._index+"-"+e).find("li.item a").removeClass("hover"),a.addClass("hover"),h[e]=c);for(var m=0,n=h.length;n>m;m++){if(!h[m]){i.seleteall=!1;break}i.seleteall=!0}l.removeClass(b.disabled),j&&j.length?$m.each(j,function(a){k.each(function(c){if(c!=e){var f=d(this).find("li.item a");f.each(function(){var c=d(this);c.attr("map")==a.split("-")[0]&&(c.hasClass("hover")&&c.removeClass("hover"),c.addClass(b.disabled))})}})}):k.each(function(){var a=d(this).find(".dd a");a.each(function(){var a=d(this);a.removeClass(b.disabled)})}),i.seleteall&&(f=i._model(h,b),i.data=i._view(f))}}var b=this.config,c=this,d=window.$,e=new Array(c.length),f=null,g=[e,c];c.seleteall=1==b.spedata.Data.length&&0==b.spedata.Data[0].SpecDetail.length?!0:!1,$m.each(b.spedata.Data,function(a){b.totalStock+=parseInt(a.Stock)}),c.data=c._view("",!0),d(this.container).find("."+b.content).delegate("a","click",g,a),d(window).bind("unload",function(){c=null})}}),a});