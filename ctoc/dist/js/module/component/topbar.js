Ymt.add(function(){function a(){var a=$(".hd-login");if(a.size()>0){var b=a.find('[href*="login"],[href*="register"]');b.each(function(a,b){var c=$(b).attr("href");$(b).attr("href",c.replace(/ret=.*/gi,"ret="+encodeURIComponent(location.href)))})}}function b(){$.ajax({url:e+"/NotificationCount/FindAllNotificationCount",dataType:"jsonp",traditional:!0,success:function(a){for(var b=0,c=0,d=0,e=0,f=0,g=0;g<a.length;g++)0==g?(b=a[g].Count,"4"==a[g].NotificationCountType&&(c=a[g].Count),"1"==a[g].NotificationCountType&&(d=a[g].Count),"2"==a[g].NotificationCountType&&(e=a[g].Count),"3"==a[g].NotificationCountType&&(f=a[g].Count)):(b+=a[g].Count,"4"==a[g].NotificationCountType&&(c+=a[g].Count),"1"==a[g].NotificationCountType&&(d+=a[g].Count),"2"==a[g].NotificationCountType&&(e+=a[g].Count),"3"==a[g].NotificationCountType&&(f+=a[g].Count));$("#siteNoticeCount").addClass("number"),0>=c?$("#siteNoticeCount").html("").removeClass("number"):9>=c?$("#siteNoticeCount").text(c):$("#siteNoticeCount").addClass("number-dots"),$("#tradeNotificationCount").addClass("number"),0>=d?$("#tradeNotificationCount").html("").removeClass("number"):9>=d?$("#tradeNotificationCount").text(d):$("#tradeNotificationCount").addClass("number-dots"),$("#siteMessageNotificationCount").addClass("number"),0>=e?$("#siteMessageNotificationCount").html("").removeClass("number"):9>=e?$("#siteMessageNotificationCount").text(e):$("#siteMessageNotificationCount").addClass("number-dots"),$("#forumReplyNotificationCount").addClass("number"),0>=f?$("#forumReplyNotificationCount").html("").removeClass("number"):9>=f?$("#forumReplyNotificationCount").text(f):$("#forumReplyNotificationCount").addClass("number-dots"),$("#notificationCount").addClass("number"),b=c+d+e+f,0>=b?$("#notificationCount").html("").removeClass("number"):9>=b?$("#notificationCount").text(b):$("#notificationCount").addClass("number-dots")},error:function(){}})}function c(a){$.ajax({url:e+"/Message/MarkMessageRead",dataType:"jsonp",traditional:!0,data:{contactUserId:a},success:function(a){"200"==a.Status&&$.ajax({url:e+"/Message/TopUnReadMessage",dataType:"jsonp",traditional:!0,data:{num:3},success:function(a){if("200"==a.Status){$("#TopUnReadMessage li").remove();for(var c=0;c<a.Result.length&&3!=c;c++)$("#TopUnReadMessage").append("<li id="+a.Result[c].ContactUserId+'><a class="txt" href="'+f+'">'+a.Result[c].Content+'</a><span class="icon-close" _dataid="'+a.Result[c].ContactUserId+'"></span></li>');b()}},error:function(){}})},error:function(){}})}var d=/\.alpha\.ymatou.com|localhost/.test(location.href),e=d?"http://top.alpha.ymatou.com":"http://top.ymatou.com",f=d?"http://www.alpha.ymatou.com/user/messageSessions":"http://www.ymatou.com/user/messageSessions",g=$("#div_topbar_logininfo01")[0]||$("#div_topbar_logininfo02")[0]||$("#div_topbar_logininfo03")[0];if(g){var h,i=$(g).attr("id").slice(-1);switch(i){case"1":h="/Template20150215/LoginInfo01jsonp";break;case"2":h="/Template20150215/LoginInfo02jsonp";break;case"3":h="/Template20150215/LoginInfo03jsonp"}$.ajax({url:e+h,dataType:"jsonp",success:function(c){$(g).replaceWith(c.content),a(),b()}})}$("#TopUnReadMessage li .icon-close").live("click",function(){c($(this).attr("_dataid"))})});